# Credential Issuer API definition

Swagger that defines how the credential issuer API should behave.

This is an API definition, the purpose is to ease the integration
of the credential backend and frontend.

The code has been autogenerated from the swagger file using this command.

```
docker run --rm -v ${PWD}:/local swaggerapi/swagger-codegen-cli generate -i /local/swagger.yaml -l nodejs-server -o /local/generated-api
```

And after, the code has been modified to add some error cases.

## Build and start generated API with Docker

Build the Docker image:

```
docker build -t credential-issuer-api .
```

Start the generated server:

```
docker run --rm -ti -p 8080:8080 credential-issuer-api
```

## Checking that it works

Run the following curl request (any DNI value except "invalid" or "500" will be accepted).

```
curl -X POST \
  http://localhost:8080/issue-credential \
  -H 'Content-Type: application/json' \
  -d '{
	"dni": "12345678A"
}'
```

The response should be:

```
{
  "credential": "1234567890"
}
```

### Checking an invalid ID case

```
curl -X POST \
  http://localhost:8080/issue-credential \
  -H 'Content-Type: application/json' \
  -d '{
	"dni": "invalid"
}'
```

The response should be:

```
{
  "error": "The specified ID is not valid"
}
```

### Checking an internal error

```
curl -X POST \
  http://localhost:8080/issue-credential \
  -H 'Content-Type: application/json' \
  -d '{
	"dni": "500"
}'
```

The response should be:

```
{
  "error": "There was an error while issuing the credential"
}
```
